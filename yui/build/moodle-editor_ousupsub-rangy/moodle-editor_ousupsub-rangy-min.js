window.rangy=function(){var c,d,l,g,p,o,t,e,r="object",n="undefined",m=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],C=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],a=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],s=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"];function f(e,t){var n=typeof e[t];return"function"==n||!(n!=r||!e[t])||"unknown"==n}function u(e,t){return!(typeof e[t]!=r||!e[t])}function N(e,t){return typeof e[t]!=n}function R(o){return function(e,t){for(var n=t.length;n--;)if(!o(e,t[n]))return!1;return!0}}function v(e){return e&&c(e,s)&&d(e,a)}function h(e){window.alert("Rangy not supported in your browser. Reason: "+e),l.initialized=!0,l.supported=!1}function E(){var e,t,n,o,r,i,a;if(!l.initialized)for(n=t=!1,f(document,"createRange")&&(e=document.createRange(),c(e,C)&&d(e,m)&&(t=!0),e.detach()),(o=u(document,"body")?document.body:document.getElementsByTagName("body")[0])&&f(o,"createTextRange")&&v(e=o.createTextRange())&&(n=!0),t||n||h("Neither Range nor TextRange are implemented"),l.initialized=!0,l.features={implementsDomRange:t,implementsTextRange:n},i=0,a=(r=p.concat(g)).length;i<a;++i)try{r[i](l)}catch(s){u(window,"console")&&f(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",s)}}function i(e){this.name=e,this.initialized=!1,this.supported=!1}if(c=R(f),e=R(u),d=R(N),(l={version:"1.2.3",initialized:!1,supported:!0,util:{isHostMethod:f,isHostObject:u,isHostProperty:N,areHostMethods:c,areHostObjects:e,areHostProperties:d,isTextRange:v},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}}).fail=h,l.warn=function(e){e="Rangy warning: "+e,l.config.alertOnWarn?window.alert(e):typeof window.console!=n&&typeof window.console.log!=n&&window.console.log(e)},!{}.hasOwnProperty?h("hasOwnProperty not supported"):l.util.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},g=[],p=[],l.init=E,l.addInitListener=function(e){l.initialized?e(l):g.push(e)},o=[],l.addCreateMissingNativeApiListener=function(e){o.push(e)},l.createMissingNativeApi=function(e){e=e||window,E();for(var t=0,n=o.length;t<n;++t)o[t](e)},i.prototype.fail=function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},i.prototype.warn=function(e){l.warn("Module "+this.name+": "+e)},i.prototype.createError=function(e){return new Error("Error in Rangy "+this.name+" module: "+e)},l.createModule=function(e,t){var n=new i(e);l.modules[e]=n,p.push(function(e){t(e,n),n.initialized=!0,n.supported=!0})},l.requireModules=function(e){for(var t,n,o=0,r=e.length;o<r;++o){if(n=e[o],!((t=l.modules[n])&&t instanceof i))throw new Error("Module '"+n+"' not found");if(!t.supported)throw new Error("Module '"+n+"' not supported")}},t=!1,e=function(e){t||(t=!0,l.initialized||E())},typeof window!=n){if(typeof document!=n)return f(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",e,!1),f(window,"addEventListener")?window.addEventListener("load",e,!1):f(window,"attachEvent")?window.attachEvent("onload",e):h("Window does not have required addEventListener or attachEvent method"),l;h("No document found")}else h("No window found")}(),rangy.createModule("DomUtil",function(e,t){var n,r,o="undefined",i=e.util;function c(e){for(var t=0;e=e.previousSibling;)t++;return t}function l(e,t){for(var n=[],o=e;o;o=o.parentNode)n.push(o);for(o=t;o;o=o.parentNode)if(r(n,o))return o;return null}function d(e,t,n){for(var o,r=n?e:e.parentNode;r;){if((o=r.parentNode)===t)return r;r=o}return null}function a(e){e=e.nodeType;return 3==e||4==e||8==e}function f(e,t){var n=t.nextSibling,t=t.parentNode;return n?t.insertBefore(e,n):t.appendChild(e),e}function s(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=o)return e.ownerDocument;if(typeof e.document!=o)return e.document;if(e.parentNode)return s(e.parentNode);throw new Error("getDocument: no document found for node")}function u(e){return e?a(e)?'"'+e.data+'"':1==e.nodeType?(t=e.id?' id="'+e.id+'"':"","<"+e.nodeName+t+">["+e.childNodes.length+"]"):e.nodeName:"[No node]";var t}function h(e){this.root=e,this._next=e}function g(e,t){this.node=e,this.offset=t}function p(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}i.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),i.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method"),n=document.createElement("div"),i.areHostMethods(n,["insertBefore","appendChild","cloneNode"])||t.fail("Incomplete Element implementation"),i.isHostProperty(n,"innerHTML")||t.fail("Element is missing innerHTML property"),n=document.createTextNode("test"),i.areHostMethods(n,["splitText","deleteData","insertData","appendData","cloneNode"])||t.fail("Incomplete Text Node implementation"),r=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},h.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},g.prototype={equals:function(e){return this.node===e.node&this.offset==e.offset},inspect:function(){return"[DomPosition("+u(this.node)+":"+this.offset+")]"}},(p.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,
NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11}).toString=function(){return this.message},e.dom={arrayContains:r,isHtmlNamespace:function(e){var t;return typeof e.namespaceURI==o||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t},parentElement:function(e){return 1==(e=e.parentNode).nodeType?e:null},getNodeIndex:c,getNodeLength:function(e){return a(e)?e.length:(e=e.childNodes)?e.length:0},getCommonAncestor:l,isAncestorOf:function(e,t,n){for(var o=n?t:t.parentNode;o;){if(o===e)return!0;o=o.parentNode}return!1},getClosestAncestorIn:d,isCharacterDataNode:a,insertAfter:f,splitDataNode:function(e,t){var n=e.cloneNode(!1);return n.deleteData(0,t),e.deleteData(t,e.length-t),f(n,e),n},getDocument:s,getWindow:function(e){if(typeof(e=s(e)).defaultView!=o)return e.defaultView;if(typeof e.parentWindow!=o)return e.parentWindow;throw new Error("Cannot get a window object for node")},getIframeWindow:function(e){if(typeof e.contentWindow!=o)return e.contentWindow;if(typeof e.contentDocument!=o)return e.contentDocument.defaultView;throw new Error("getIframeWindow: No Window object found for iframe element")},getIframeDocument:function(e){if(typeof e.contentDocument!=o)return e.contentDocument;if(typeof e.contentWindow!=o)return e.contentWindow.document;throw new Error("getIframeWindow: No Document object found for iframe element")},getBody:function(e){return i.isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]},getRootContainer:function(e){for(var t;t=e.parentNode;)e=t;return e},comparePoints:function(e,t,n,o){var r,i,a,s;if(e==n)return t===o?0:t<o?-1:1;if(r=d(n,e,!0))return t<=c(r)?-1:1;if(r=d(e,n,!0))return c(r)<o?-1:1;if((i=e===(t=l(e,n))?t:d(e,t,!0))===(a=n===t?t:d(n,t,!0)))throw new Error("comparePoints got to case 4 and childA and childB are the same!");for(s=t.firstChild;s;){if(s===i)return-1;if(s===a)return 1;s=s.nextSibling}throw new Error("Should not be here!")},inspectNode:u,fragmentFromNodeChildren:function(e){for(var t,n=s(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n},createIterator:function(e){return new h(e)},DomPosition:g},e.DOMException=p}),rangy.createModule("DomRange",function(i,e){var l,t,a,g,p,o,r,s,m,C,N,R,v,E,S,y,w,T,O,_,D,x;function A(e,t){return 3!=e.nodeType&&(l.isAncestorOf(e,t.startContainer,!0)||l.isAncestorOf(e,t.endContainer,!0))}function c(e){return l.getDocument(e.startContainer)}function b(e,t,n){var o,r,i=e._listeners[t];if(i)for(o=0,r=i.length;o<r;++o)i[o].call(e,{target:e,args:n})}function I(e){return new t(e.parentNode,l.getNodeIndex(e))}function P(e){return new t(e.parentNode,l.getNodeIndex(e)+1)}function M(e,t,n){var o=11==e.nodeType?e.firstChild:e;return l.isCharacterDataNode(t)?n==t.length?l.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:l.splitDataNode(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),o}function B(e,t,n){var o,r,i,a;for(n=n||{stop:!1};i=e.next();)if(e.isPartiallySelectedSubtree()){if(!1===t(i))return void(n.stop=!0);if(B(a=e.getSubtreeIterator(),t,n),a.detach(!0),n.stop)return}else for(o=l.createIterator(i);r=o.next();)if(!1===t(r))return void(n.stop=!0)}function H(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(H(t=e.getSubtreeIterator()),t.detach(!0)):e.remove()}function W(e){for(var t,n,o=c(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(W(n)),n.detach(!0)):e.remove(),10==t.nodeType)throw new a("HIERARCHY_REQUEST_ERR");o.appendChild(t)}return o}function L(e,t,n){var o,r,i=!(!t||!t.length),a=!!n;return i&&(o=new RegExp("^("+t.join("|")+")$")),B(new f(e,!(r=[])),function(e){i&&!o.test(e.nodeType)||a&&!n(e)||r.push(e)}),r}function k(e){return"["+("undefined"==typeof e.getName?"Range":e.getName())+"("+l.inspectNode(e.startContainer)+":"+e.startOffset+", "+l.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function f(e,t){this.range=e,this.clonePartiallySelectedTextNodes=t,e.collapsed||(this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset,t=e.commonAncestorContainer,this.sc===this.ec&&l.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==t||l.isCharacterDataNode(this.sc)?l.getClosestAncestorIn(this.sc,t,!0):this.sc.childNodes[this.so],this._last=this.ec!==t||l.isCharacterDataNode(this.ec)?l.getClosestAncestorIn(this.ec,t,!0):this.ec.childNodes[this.eo-1]))}function n(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function U(e,t,n){this.nodes=L(e,t,n),this._next=this.nodes[0],this._position=0}function z(r){return function(e,t){for(var n,o=t?e:e.parentNode;o;){if(n=o.nodeType,l.arrayContains(r,n))return o;o=o.parentNode}return null}}function F(e,t){if(N(e,t))throw new n("INVALID_NODE_TYPE_ERR")}function u(e){if(!e.startContainer)throw new a("INVALID_STATE_ERR")}function j(e,t){if(!l.arrayContains(t,e.nodeType))throw new n("INVALID_NODE_TYPE_ERR")}function V(e,t){t<0||(l.isCharacterDataNode(e)?e:e.childNodes).length}function q(e,t){if(m(e,!0)!==m(t,!0))throw new a("WRONG_DOCUMENT_ERR")}function Y(e){if(C(e,!0))throw new a("NO_MODIFICATION_ALLOWED_ERR")}function $(e,t){if(!e)throw new a(t)}function Q(e){return!l.arrayContains(p,e.nodeType)&&!m(e,!0)}function G(e,t){return t<=(l.isCharacterDataNode(e)?e:e.childNodes).length}function X(e){return!!e.startContainer&&!!e.endContainer&&!Q(e.startContainer)&&!Q(e.endContainer)&&G(e.startContainer,e.startOffset)&&G(e.endContainer,e.endOffset)}function h(e){u(e),X(e)}i.requireModules(["DomUtil"]),l=i.dom,t=l.DomPosition,a=i.DOMException,f.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,
l.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!l.isCharacterDataNode(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(e=n===this.sc?this.so:0)!=(t=n===this.ec?this.eo:n.length)&&n.deleteData(e,t-e)},isPartiallySelectedSubtree:function(){return A(this._current,this.range)},getSubtreeIterator:function(){var e,t,n,o,r,i;return this.isSingleCharacterDataNode?(e=this.range.cloneRange()).collapse():(e=new d(c(this.range)),t=this._current,o=0,i=l.getNodeLength(r=n=t),l.isAncestorOf(t,this.sc,!0)&&(n=this.sc,o=this.so),l.isAncestorOf(t,this.ec,!0)&&(r=this.ec,i=this.eo),oe(e,n,o,r,i)),new f(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},(n.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2}).toString=function(){return this.message},U.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}},g=[1,3,4,5,7,8,10],p=[2,9,11],o=[1,3,4,5,7,8,10,11],r=[1,3,4,5,7,8],s=l.getRootContainer,m=z([9,11]),C=z([5,6,10,12]),N=z([6,10,12]),R=document.createElement("style"),v=!1;try{R.innerHTML="<b>x</b>",v=3==R.firstChild.nodeType}catch(re){}function Z(){}function J(e){e.START_TO_START=S,e.START_TO_END=y,e.END_TO_END=w,e.END_TO_START=T,e.NODE_BEFORE=O,e.NODE_AFTER=_,e.NODE_BEFORE_AND_AFTER=D,e.NODE_INSIDE=x}function K(e){J(e),J(e.prototype)}function ee(r,i){return function(){var e,t,n,o;return h(this),e=this.startContainer,t=this.startOffset,o=this.commonAncestorContainer,n=new f(this,!0),e!==o&&(e=(o=P(l.getClosestAncestorIn(e,o,!0))).node,t=o.offset),B(n,Y),n.reset(),o=r(n),n.detach(),i(this,e,t,e,t),o}}function te(e,d,t){function n(t,n){return function(e){u(this),j(e,g),j(s(e),p);e=(t?I:P)(e);(n?o:r)(this,e.node,e.offset)}}function o(e,t,n){var o=e.endContainer,r=e.endOffset;t===e.startContainer&&n===e.startOffset||(s(t)==s(o)&&1!=l.comparePoints(t,n,o,r)||(o=t,r=n),d(e,t,n,o,r))}function r(e,t,n){var o=e.startContainer,r=e.startOffset;t===e.endContainer&&n===e.endOffset||(s(t)==s(o)&&-1!=l.comparePoints(t,n,o,r)||(o=t,r=n),d(e,o,r,t,n))}e.prototype=new Z,i.util.extend(e.prototype,{setStart:function(e,t){u(this),F(e,!0),V(e,t),o(this,e,t)},setEnd:function(e,t){u(this),F(e,!0),V(e,t),r(this,e,t)},setStartBefore:n(!0,!0),setStartAfter:n(!1,!0),setEndBefore:n(!0,!1),setEndAfter:n(!1,!1),collapse:function(e){h(this),e?d(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){u(this),F(e,!0),d(this,e,0,e,l.getNodeLength(e))},selectNode:function(e){u(this),F(e,!1),j(e,g);var t=I(e),e=P(e);d(this,t.node,t.offset,e.node,e.offset)},extractContents:ee(W,d),deleteContents:ee(H,d),canSurroundContents:function(){var e,t;return h(this),Y(this.startContainer),Y(this.endContainer),t=(e=new f(this,!0))._first&&A(e._first,this)||e._last&&A(e._last,this),e.detach(),!t},detach:function(){t(this)},splitBoundaries:function(){var e,t,n,o,r;h(this),e=this.startContainer,t=this.startOffset,n=this.endContainer,o=this.endOffset,r=e===n,l.isCharacterDataNode(n)&&0<o&&o<n.length&&l.splitDataNode(n,o),l.isCharacterDataNode(e)&&0<t&&t<e.length&&(e=l.splitDataNode(e,t),r?(o-=t,n=e):n==e.parentNode&&o>=l.getNodeIndex(e)&&o++,t=0),d(this,e,t,n,o)},normalizeBoundaries:function(){var o,r,i,a,e,t,n,s,c;h(this),o=this.startContainer,r=this.startOffset,i=this.endContainer,a=this.endOffset,e=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(a=(i=e).length,e.appendData(t.data),t.parentNode.removeChild(t))},t=function(e){var t,n=e.previousSibling;n&&n.nodeType==e.nodeType&&(t=(o=e).length,r=n.length,e.insertData(0,n.data),n.parentNode.removeChild(n),o==i?(a+=r,i=o):i==e.parentNode&&(n=l.getNodeIndex(e),a==n?(i=e,a=t):n<a&&a--))},n=!0,l.isCharacterDataNode(i)?i.length==a&&e(i):(0<a&&(s=i.childNodes[a-1])&&l.isCharacterDataNode(s)&&e(s),n=!this.collapsed),n?l.isCharacterDataNode(o)?0==r&&t(o):r<o.childNodes.length&&(c=o.childNodes[r])&&l.isCharacterDataNode(c)&&t(c):(o=i,r=a),d(this,o,r,i,a)},collapseToPoint:function(e,t){var n;u(this),F(e,!0),V(e,t),t=t,(e=e)===(n=this).startContainer&&t===n.startOffset&&e===n.endContainer&&t===n.endOffset||d(n,e,t,e,t)}}),K(e)}function ne(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:l.getCommonAncestor(e.startContainer,e.endContainer)}function oe(e,t,n,o,r){var i=e.startContainer!==t||e.startOffset!==n,a=e.endContainer!==o||e.endOffset!==r;e.startContainer=t,e.startOffset=n,e.endContainer=o,e.endOffset=r,ne(e),b(e,"boundarychange",{startMoved:i,endMoved:a})}function d(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},ne(this)}i.features.htmlParsingConforms=v,E=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],O=S=0,_=y=1,D=w=2,x=T=3,Z.prototype={attachListener:function(e,t){this._listeners[e].push(t)},compareBoundaryPoints:function(e,t){var n,o,r;return h(this),q(this.startContainer,t.startContainer),r=e==y||e==S?"start":"end",n=this[(e=e==T||e==S?"start":"end")+"Container"],e=this[e+"Offset"],o=t[r+"Container"],r=t[r+"Offset"],l.comparePoints(n,e,o,r)},insertNode:function(e){if(h(this),j(e,o),Y(this.startContainer),l.isAncestorOf(e,this.startContainer,!0))throw new a("HIERARCHY_REQUEST_ERR");e=M(e,this.startContainer,this.startOffset);this.setStartBefore(e)},cloneContents:function(){var e,t;return h(this),this.collapsed?c(this
).createDocumentFragment():this.startContainer===this.endContainer&&l.isCharacterDataNode(this.startContainer)?((e=this.startContainer.cloneNode(!0)).data=e.data.slice(this.startOffset,this.endOffset),(t=c(this).createDocumentFragment()).appendChild(e),t):(e=function r(e){for(var t,n,o=c(e.range).createDocumentFragment();t=e.next();){if(n=e.isPartiallySelectedSubtree(),t=t.cloneNode(!n),n&&(n=e.getSubtreeIterator(),t.appendChild(r(n)),n.detach(!0)),10==t.nodeType)throw new a("HIERARCHY_REQUEST_ERR");o.appendChild(t)}return o}(t=new f(this,!0)),t.detach(),e)},canSurroundContents:function(){var e,t;return h(this),Y(this.startContainer),Y(this.endContainer),t=(e=new f(this,!0))._first&&A(e._first,this)||e._last&&A(e._last,this),e.detach(),!t},surroundContents:function(e){if(j(e,r),!this.canSurroundContents())throw new n("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);M(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){var e,t,n;for(h(this),e=new d(c(this)),t=E.length;t--;)e[n=E[t]]=this[n];return e},toString:function(){var t,e;return h(this),(e=this.startContainer)===this.endContainer&&l.isCharacterDataNode(e)?3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"":(t=[],B(e=new f(this,!0),function(e){3!=e.nodeType&&4!=e.nodeType||t.push(e.data)}),e.detach(),t.join(""))},compareNode:function(e){var t,n;if(h(this),n=e.parentNode,e=l.getNodeIndex(e),!n)throw new a("NOT_FOUND_ERR");return t=this.comparePoint(n,e),n=this.comparePoint(n,e+1),t<0?0<n?D:O:0<n?_:x},comparePoint:function(e,t){return h(this),$(e,"HIERARCHY_REQUEST_ERR"),q(e,this.startContainer),l.comparePoints(e,t,this.startContainer,this.startOffset)<0?-1:0<l.comparePoints(e,t,this.endContainer,this.endOffset)?1:0},createContextualFragment:v?function(e){var t,n=this.startContainer,o=l.getDocument(n);if(!n)throw new a("INVALID_STATE_ERR");return t=null,1==n.nodeType?t=n:l.isCharacterDataNode(n)&&(t=l.parentElement(n)),(t=null===t||"HTML"==t.nodeName&&l.isHtmlNamespace(l.getDocument(t).documentElement)&&l.isHtmlNamespace(t)?o.createElement("body"):t.cloneNode(!1)).innerHTML=e,l.fragmentFromNodeChildren(t)}:function(e){var t;return u(this),(t=c(this).createElement("body")).innerHTML=e,l.fragmentFromNodeChildren(t)},toHtml:function(){h(this);var e=c(this).createElement("div");return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){var n,o;return h(this),$(e,"NOT_FOUND_ERR"),l.getDocument(e)===c(this)&&(o=e.parentNode,e=l.getNodeIndex(e),$(o,"NOT_FOUND_ERR"),n=l.comparePoints(o,e,this.endContainer,this.endOffset),o=l.comparePoints(o,e+1,this.startContainer,this.startOffset),t?n<=0&&0<=o:n<0&&0<o)},isPointInRange:function(e,t){return h(this),$(e,"HIERARCHY_REQUEST_ERR"),q(e,this.startContainer),0<=l.comparePoints(e,t,this.startContainer,this.startOffset)&&l.comparePoints(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e,t){if(h(this),c(e)!=c(this))throw new a("WRONG_DOCUMENT_ERR");var n=l.comparePoints(this.startContainer,this.startOffset,e.endContainer,e.endOffset),e=l.comparePoints(this.endContainer,this.endOffset,e.startContainer,e.startOffset);return t?n<=0&&0<=e:n<0&&0<e},intersection:function(e){var t,n,o;return this.intersectsRange(e)?(t=l.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=l.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset),o=this.cloneRange(),-1==t&&o.setStart(e.startContainer,e.startOffset),1==n&&o.setEnd(e.endContainer,e.endOffset),o):null},union:function(e){var t;if(this.intersectsRange(e,!0))return t=this.cloneRange(),-1==l.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==l.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t;throw new n("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==x},containsNodeContents:function(e){return 0<=this.comparePoint(e,0)&&this.comparePoint(e,l.getNodeLength(e))<=0},containsRange:function(e){return this.intersection(e).equals(e)},containsNodeText:function(e){var t,n=this.cloneRange();return n.selectNode(e),0<(t=n.getNodes([3])).length?(n.setStart(t[0],0),t=t.pop(),n.setEnd(t,t.length),t=this.containsRange(n),n.detach(),t):this.containsNodeContents(e)},createNodeIterator:function(e,t){return h(this),new U(this,e,t)},getNodes:function(e,t){return h(this),L(this,e,t)},getDocument:function(){return c(this)},collapseBefore:function(e){u(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){u(this),this.setStartAfter(e),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(e){return d.rangesEqual(this,e)},isValid:function(){return X(this)},inspect:function(){return k(this)}},te(d,oe,function(e){u(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=null,e.collapsed=e.commonAncestorContainer=null,b(e,"detach",null),e._listeners=null}),i.rangePrototype=Z.prototype,d.rangeProperties=E,d.RangeIterator=f,d.copyComparisonConstants=K,d.createPrototypeRange=te,d.inspect=k,d.getRangeDocument=c,d.rangesEqual=function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset},i.DomRange=d,i.RangeException=n}),rangy.createModule("WrappedRange",function(t,c){var n,u,h,d;function l(e,t,n,o){var r,i,l,f,a,s,c,d=e.duplicate();if(d.collapse(n),r=d.parentElement(),!(r=u.isAncestorOf(t,r,!0)?r:t).canHaveHTML)return new h(r.parentNode,u.getNodeIndex(r));for((i=u.getDocument(r).createElement("span")).parentNode&&i.parentNode.removeChild(i),f=n?"StartToStart":"StartToEnd";r.insertBefore(i,i.previousSibling),d.moveToElementText(i),0<(l=d.compareEndPoints(f,e))&&i.previousSibling;);if(t=i.nextSibling,-1==l&&t&&u.isCharacterDataNode(t)){
if(d.setEndPoint(n?"EndToStart":"EndToEnd",e),/[\r\n]/.test(t.data))for(c=(s=d.duplicate()).text.replace(/\r\n/g,"\r").length,a=s.moveStart("character",c);-1==(l=s.compareEndPoints("StartToEnd",s));)a++,s.moveStart("character",1);else a=d.text.length;c=new h(t,a)}else t=(o||!n)&&i.previousSibling,c=(o=(o||n)&&i.nextSibling)&&u.isCharacterDataNode(o)?new h(o,0):t&&u.isCharacterDataNode(t)?new h(t,t.length):new h(r,u.getNodeIndex(i));return i.parentNode.removeChild(i),c}function f(e,t){var n,o=e.offset,r=u.getDocument(e.node),i=r.body.createTextRange(),a=u.isCharacterDataNode(e.node),s=a?(n=e.node).parentNode:(n=o<(s=e.node.childNodes).length?s[o]:null,e.node),e=r.createElement("span");return e.innerHTML="&#feff;",n?s.insertBefore(e,n):s.appendChild(e),i.moveToElementText(e),i.collapse(!t),s.removeChild(e),a&&i[t?"moveStart":"moveEnd"]("character",o),i}if(t.requireModules(["DomUtil","DomRange"]),u=t.dom,h=u.DomPosition,d=t.DomRange,!t.features.implementsDomRange||t.features.implementsTextRange&&t.config.preferTextRange)t.features.implementsTextRange&&((n=function(e){this.textRange=e,this.refresh()}).prototype=new d(document),n.prototype.refresh=function(){n=this.textRange,r=n.parentElement(),(t=n.duplicate()).collapse(!0),o=t.parentElement(),(t=n.duplicate()).collapse(!1);var e,t,n,o=(t=o==(n=t.parentElement())?o:u.getCommonAncestor(o,n))==r?t:u.getCommonAncestor(r,t),r=0==(n=this.textRange).compareEndPoints("StartToEnd",n)?e=l(this.textRange,o,!0,!0):(e=l(this.textRange,o,!0,!1),l(this.textRange,o,!1,!1));this.setStart(e.node,e.offset),this.setEnd(r.node,r.offset)},d.copyComparisonConstants(n),"undefined"==typeof(e=function(){return this}()).Range&&(e.Range=n),t.createNativeRange=function(e){return(e=e||document).body.createTextRange()});else{var e,o,r,i,g=d.rangeProperties;function a(e){for(var t,n=g.length;n--;)e[t=g[n]]=e.nativeRange[t]}n=function(e){if(!e)throw new Error("Range must be specified");this.nativeRange=e,a(this)},d.createPrototypeRange(n,function(e,t,n,o,r){var i=e.startContainer!==t||e.startOffset!=n,a=e.endContainer!==o||e.endOffset!=r;(i||a)&&(e.setEnd(o,r),e.setStart(t,n))},function(e){e.nativeRange.detach(),e.detached=!0;for(var t=g.length;t--;)e[g[t]]=null}),(e=n.prototype).selectNode=function(e){this.nativeRange.selectNode(e),a(this)},e.deleteContents=function(){this.nativeRange.deleteContents(),a(this)},e.extractContents=function(){var e=this.nativeRange.extractContents();return a(this),e},e.cloneContents=function(){return this.nativeRange.cloneContents()},e.surroundContents=function(e){this.nativeRange.surroundContents(e),a(this)},e.collapse=function(e){this.nativeRange.collapse(e),a(this)},e.cloneRange=function(){return new n(this.nativeRange.cloneRange())},e.refresh=function(){a(this)},e.toString=function(){return this.nativeRange.toString()},o=document.createTextNode("test"),u.getBody(document).appendChild(o),(r=document.createRange()).setStart(o,0),r.setEnd(o,0);try{r.setStart(o,1),e.setStart=function(e,t){this.nativeRange.setStart(e,t),a(this)},e.setEnd=function(e,t){this.nativeRange.setEnd(e,t),a(this)},i=function(t){return function(e){this.nativeRange[t](e),a(this)}}}catch(s){e.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(s){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}a(this)},e.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(s){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}a(this)},i=function(t,n){return function(e){try{this.nativeRange[t](e)}catch(s){this.nativeRange[n](e),this.nativeRange[t](e)}a(this)}}}e.setStartBefore=i("setStartBefore","setEndBefore"),e.setStartAfter=i("setStartAfter","setEndAfter"),e.setEndBefore=i("setEndBefore","setStartBefore"),e.setEndAfter=i("setEndAfter","setStartAfter"),r.selectNodeContents(o),r.startContainer==o&&r.endContainer==o&&0==r.startOffset&&r.endOffset==o.length?e.selectNodeContents=function(e){this.nativeRange.selectNodeContents(e),a(this)}:e.selectNodeContents=function(e){this.setStart(e,0),this.setEnd(e,d.getEndOffset(e))},r.selectNodeContents(o),r.setEnd(o,3),(i=document.createRange()).selectNodeContents(o),i.setEnd(o,4),i.setStart(o,2),-1==r.compareBoundaryPoints(r.START_TO_END,i)&1==r.compareBoundaryPoints(r.END_TO_START,i)?e.compareBoundaryPoints=function(e,t){return e==(t=t.nativeRange||t).START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:e.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)},t.util.isHostMethod(r,"createContextualFragment")&&(e.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),u.getBody(document).removeChild(o),r.detach(),i.detach(),t.createNativeRange=function(e){return(e=e||document).createRange()}}t.features.implementsTextRange&&(n.rangeToTextRange=function(e){var t,n;return e.collapsed?f(new h(e.startContainer,e.startOffset),!0):(t=f(new h(e.startContainer,e.startOffset),!0),n=f(new h(e.endContainer,e.endOffset),!1),(e=u.getDocument(e.startContainer).body.createTextRange()).setEndPoint("StartToStart",t),e.setEndPoint("EndToEnd",n),e)}),n.prototype.getName=function(){return"WrappedRange"},t.WrappedRange=n,t.createRange=function(e){return e=e||document,new n(t.createNativeRange(e))},t.createRangyRange=function(e){return e=e||document,new d(e)},t.createIframeRange=function(e){return t.createRange(u.getIframeDocument(e))},t.createIframeRangyRange=function(e){return t.createRangyRange(u.getIframeDocument(e))},t.addCreateMissingNativeApiListener(function(e){e=e.document;"undefined"==typeof e.createRange&&(e.createRange=function(){return t.createRange(this)})})}),rangy.createModule("WrappedSelection",function(i,l){var f,u,c,e,s,h,g,p,m,C,d,N,R,t,v,E,n,S,y,w,T,a,O,_,D,x,A,o,b,r,I,P;function M(e){return(e||window).document.selection}function B(e,t,n){var o=n?"end":"start",n=n?"start":"end";e.anchorNode=t[o+"Container"],e.anchorOffset=t[o+"Offset"],e.focusNode=t[n+"Container"],
e.focusOffset=t[n+"Offset"]}function H(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function W(e){var t;return e instanceof s?(t=e._selectionNativeRange)||((t=i.createNativeRange(c.getDocument(e.startContainer))).setEnd(e.endContainer,e.endOffset),t.setStart(e.startContainer,e.startOffset),e._selectionNativeRange=t,e.attachListener("detach",function(){this._selectionNativeRange=null})):e instanceof h?t=e.nativeRange:i.features.implementsDomRange&&e instanceof c.getWindow(e.startContainer).Range&&(t=e),t}function L(e){var t=e.getNodes();if(!function(e){if(e.length&&1==e[0].nodeType){for(var t=1,n=e.length;t<n;++t)if(!c.isAncestorOf(e[0],e[t]))return;return 1}}(t))throw new Error("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return t[0]}function k(e){return e&&"undefined"!=typeof e.text}function U(e,t){t=new h(t);e._ranges=[t],B(e,t,!1),e.rangeCount=1,e.isCollapsed=t.collapsed}function z(e){var t,n,o,r;if(e._ranges.length=0,"None"==e.docSelection.type)H(e);else if(k(t=e.docSelection.createRange()))U(e,t);else{for(e.rangeCount=t.length,o=c.getDocument(t.item(0)),r=0;r<e.rangeCount;++r)(n=i.createRange(o)).selectNode(t.item(r)),e._ranges.push(n);e.isCollapsed=1==e.rangeCount&&e._ranges[0].collapsed,B(e,e._ranges[e.rangeCount-1],!1)}}function F(e,t){for(var n=e.docSelection.createRange(),t=L(t),o=c.getDocument(n.item(0)),r=c.getBody(o).createControlRange(),i=0,a=n.length;i<a;++i)r.add(n.item(i));try{r.add(t)}catch(s){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}r.select(),z(e)}function j(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function V(e,t){for(var n,o=c.getDocument(t[0].startContainer),r=c.getBody(o).createControlRange(),i=0;i<rangeCount;++i){n=L(t[i]);try{r.add(n)}catch(a){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}r.select(),z(e)}if(i.requireModules(["DomUtil","DomRange","WrappedRange"]),i.config.checkSelectionRanges=!0,f="boolean",u="_rangySelection",c=i.dom,e=i.util,s=i.DomRange,h=i.WrappedRange,g=i.DOMException,p=c.DomPosition,d="Control",t=i.util.isHostMethod(window,"getSelection"),(R=(N=i.util.isHostObject(document,"selection"))&&(!t||i.config.preferTextRange))?(m=M,i.isSelectionValid=function(e){var e=(e||window).document,t=e.selection;return"None"!=t.type||c.getDocument(t.createRange().parentElement())==e}):t?(m=function(e){return(e||window).getSelection()},i.isSelectionValid=function(){return!0}):l.fail("Neither document.selection or window.getSelection() detected."),t=(i.getNativeSelection=m)(),v=i.createNativeRange(document),E=c.getBody(document),n=e.areHostObjects(t,e.areHostProperties(t,["anchorOffset","focusOffset"])),i.features.selectionHasAnchorAndFocus=n,S=e.isHostMethod(t,"extend"),i.features.selectionHasExtend=S,y="number"==typeof t.rangeCount,i.features.selectionHasRangeCount=y,T=!(w=!1),e.areHostMethods(t,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof t.rangeCount&&i.features.implementsDomRange&&((P=document.createElement("iframe")).frameBorder=0,P.style.position="absolute",P.style.left="-10000px",E.appendChild(P),(r=c.getIframeDocument(P)).open(),r.write("<html><head></head><body>12</body></html>"),r.close(),o=c.getIframeWindow(P).getSelection(),b=r.documentElement.lastChild.firstChild,(r=r.createRange()).setStart(b,1),r.collapse(!0),o.addRange(r),T=1==o.rangeCount,o.removeAllRanges(),I=r.cloneRange(),r.setStart(b,0),I.setEnd(b,2),o.addRange(r),o.addRange(I),w=2==o.rangeCount,r.detach(),I.detach(),E.removeChild(P)),i.features.selectionSupportsMultipleRanges=w,i.features.collapsedNonEditableSelectionsSupported=T,a=!1,E&&e.isHostMethod(E,"createControlRange")&&(b=E.createControlRange(),e.areHostProperties(b,["item","add"])&&(a=!0)),i.features.implementsControlRange=a,C=n?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return!!e.rangeCount&&e.getRangeAt(e.rangeCount-1).collapsed},e.isHostMethod(t,"getRangeAt")?O=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:n&&(O=function(e){var t=c.getDocument(e.anchorNode),t=i.createRange(t);return t.setStart(e.anchorNode,e.anchorOffset),t.setEnd(e.focusNode,e.focusOffset),t.collapsed!==this.isCollapsed&&(t.setStart(e.focusNode,e.focusOffset),t.setEnd(e.anchorNode,e.anchorOffset)),t}),i.getSelection=function(e){var t=(e=e||window)[u],n=m(e),o=N?M(e):null;return t?(t.nativeSelection=n,t.docSelection=o,t.refresh(e)):(t=new j(n,o,e),e[u]=t),t},i.getIframeSelection=function(e){return i.getSelection(c.getIframeWindow(e))},o=j.prototype,!R&&n&&e.areHostMethods(t,["removeAllRanges","addRange"]))o.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),H(this)},_=function(e,t){var n=s.getRangeDocument(t),n=i.createRange(n);n.collapseToPoint(t.endContainer,t.endOffset),e.nativeSelection.addRange(W(n)),e.nativeSelection.extend(t.startContainer,t.startOffset),e.refresh()},o.addRange=y?function(e,t){var n;a&&N&&this.docSelection.type==d?F(this,e):t&&S?_(this,e):(t=w?this.rangeCount:(this.removeAllRanges(),0),this.nativeSelection.addRange(W(e)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==t+1?(i.config.checkSelectionRanges&&(n=O(this.nativeSelection,this.rangeCount-1))&&!s.rangesEqual(n,e)&&(e=new h(n)),this._ranges[this.rangeCount-1]=e,B(this,e,A(this.nativeSelection)),this.isCollapsed=C(this)):this.refresh())}:function(e,t){t&&S?_(this,e):(this.nativeSelection.addRange(W(e)),this.refresh())},o.setRanges=function(e){if(a&&1<e.length)V(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}};else{if(!(e.isHostMethod(t,"empty")&&e.isHostMethod(v,"select")&&a&&R))return l.fail("No means of selecting a Range or TextRange was found"),!1;o.removeAllRanges=function(){var e,t;
try{this.docSelection.empty(),"None"!=this.docSelection.type&&(this.anchorNode?e=c.getDocument(this.anchorNode):this.docSelection.type==d&&(t=this.docSelection.createRange()).length&&(e=c.getDocument(t.item(0)).body.createTextRange()),e&&(e.body.createTextRange().select(),this.docSelection.empty()))}catch(n){}H(this)},o.addRange=function(e){this.docSelection.type==d?F(this,e):(h.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,B(this,e,!1))},o.setRanges=function(e){this.removeAllRanges();var t=e.length;1<t?V(this,e):t&&this.addRange(e[0])}}if(o.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new g("INDEX_SIZE_ERR");return this._ranges[e]},R)D=function(e){var t;i.isSelectionValid(e.win)?t=e.docSelection.createRange():(t=c.getBody(e.win.document).createTextRange()).collapse(!0),e.docSelection.type==d?z(e):k(t)?U(e,t):H(e)};else if(e.isHostMethod(t,"getRangeAt")&&"number"==typeof t.rangeCount)D=function(e){if(a&&N&&e.docSelection.type==d)z(e);else if(e._ranges.length=e.rangeCount=e.nativeSelection.rangeCount,e.rangeCount){for(var t=0,n=e.rangeCount;t<n;++t)e._ranges[t]=new i.WrappedRange(e.nativeSelection.getRangeAt(t));B(e,e._ranges[e.rangeCount-1],A(e.nativeSelection)),e.isCollapsed=C(e)}else H(e)};else{if(!n||typeof t.isCollapsed!=f||typeof v.collapsed!=f||!i.features.implementsDomRange)return l.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;D=function(e){var t,n=e.nativeSelection;n.anchorNode?(n=O(n,0),e._ranges=[n],e.rangeCount=1,t=(n=e).nativeSelection,n.anchorNode=t.anchorNode,n.anchorOffset=t.anchorOffset,n.focusNode=t.focusNode,n.focusOffset=t.focusOffset,e.isCollapsed=C(e)):H(e)}}function q(e,t){if(e.anchorNode&&c.getDocument(e.anchorNode)!==c.getDocument(t))throw new g("WRONG_DOCUMENT_ERR")}function Y(e){var t,n,o=[],r=new p(e.anchorNode,e.anchorOffset),i=new p(e.focusNode,e.focusOffset),a="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(t=0,n=e.rangeCount;t<n;++t)o[t]=s.inspect(e.getRangeAt(t));return"["+a+"(Ranges: "+o.join(", ")+")(anchor: "+r.inspect()+", focus: "+i.inspect()+"]"}o.refresh=function(e){var t,n=e?this._ranges.slice(0):null;if(D(this),e){if((t=n.length)!=this._ranges.length)return!1;for(;t--;)if(!s.rangesEqual(n[t],this._ranges[t]))return!1;return!0}},x=function(e,t){var n,o,r=e.getAllRanges(),i=!1;for(e.removeAllRanges(),n=0,o=r.length;n<o;++n)i||t!==r[n]?e.addRange(r[n]):i=!0;e.rangeCount||H(e)},o.removeRange=a?function(e){var t,n,o,r,i,a,s;if(this.docSelection.type==d){for(t=this.docSelection.createRange(),n=L(e),o=c.getDocument(t.item(0)),r=c.getBody(o).createControlRange(),i=!1,a=0,s=t.length;a<s;++a)t.item(a)!==n||i?r.add(t.item(a)):i=!0;r.select(),z(this)}else x(this,e)}:function(e){x(this,e)},!R&&n&&i.features.implementsDomRange?(A=function(e){var t=!1;return t=e.anchorNode?1==c.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset):t},o.isBackwards=function(){return A(this)}):A=o.isBackwards=function(){return!1},o.toString=function(){for(var e=[],t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},o.collapse=function(e,t){q(this,e);var n=i.createRange(c.getDocument(e));n.collapseToPoint(e,t),this.removeAllRanges(),this.addRange(n),this.isCollapsed=!0},o.collapseToStart=function(){if(!this.rangeCount)throw new g("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},o.collapseToEnd=function(){if(!this.rangeCount)throw new g("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},o.selectAllChildren=function(e){q(this,e);var t=i.createRange(c.getDocument(e));t.selectNodeContents(e),this.removeAllRanges(),this.addRange(t)},o.deleteFromDocument=function(){var e,t,n,o,r;if(a&&N&&this.docSelection.type==d){for(e=this.docSelection.createRange();e.length;)t=e.item(0),e.remove(t),t.parentNode.removeChild(t);this.refresh()}else if(this.rangeCount){for(n=this.getAllRanges(),this.removeAllRanges(),o=0,r=n.length;o<r;++o)n[o].deleteContents();this.addRange(n[r-1])}},o.getAllRanges=function(){return this._ranges.slice(0)},o.setSingleRange=function(e){this.setRanges([e])},o.containsNode=function(e,t){for(var n=0,o=this._ranges.length;n<o;++n)if(this._ranges[n].containsNode(e,t))return!0;return!1},o.toHtml=function(){var e,t,n,o="";if(this.rangeCount){for(e=s.getRangeDocument(this._ranges[0]).createElement("div"),t=0,n=this._ranges.length;t<n;++t)e.appendChild(this._ranges[t].cloneContents());o=e.innerHTML}return o},o.getName=function(){return"WrappedSelection"},o.inspect=function(){return Y(this)},o.detach=function(){this.win[u]=null,this.win=this.anchorNode=this.focusNode=null},j.inspect=Y,i.Selection=j,i.selectionPrototype=o,i.addCreateMissingNativeApiListener(function(e){"undefined"==typeof e.getSelection&&(e.getSelection=function(){return i.getSelection(this)})})}),rangy.createModule("CssClassApplier",function(a,u){var d,r,t,n,c,h,m,C,g,l,e;function o(e,t){return e.className&&new RegExp("(?:^|\\s)"+t+"(?:\\s|$)").test(e.className)}function i(e,t){e.className?o(e,t)||(e.className+=" "+t):e.className=t}function p(e,t,n){return t&&n?" ":""}function N(e){return e.split(/\s+/).sort().join(" ")}function R(e){return N(e.className)}function v(e,t){return R(e)==R(t)}function E(e){for(var t=e.parentNode;e.hasChildNodes();)t.insertBefore(e.firstChild,e);t.removeChild(e)}function S(e,t){var n=e.cloneRange();return n.selectNodeContents(t),e=(t=n.intersection(e))?t.toString():"",n.detach(),""!=e}function y(t){return t.getNodes([3],function(e){return S(t,e)})}function w(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n,o,r=0,i=e.attributes.length;r<i;++r)if("class"!=(o=(n=e.attributes[r]).name)){if(o=t.attributes.getNamedItem(o),n.specified!=o.specified)return!1;if(n.specified&&n.nodeValue!==o.nodeValue)return!1}return!0}function T(e,t){for(var n,o=0,r=e.attributes.length;o<r;++o)if(
n=e.attributes[o].name,(!t||!d.arrayContains(t,n))&&e.attributes[o].specified&&"class"!=n)return!0;return!1}function O(e){var t;return e&&1==e.nodeType&&((t=e.parentNode)&&9==t.nodeType&&"on"==t.designMode||n(e)&&!n(e.parentNode))}function _(e){return(n(e)||1!=e.nodeType&&n(e.parentNode))&&!O(e)}function D(e){return e&&1==e.nodeType&&!c.test(t(e,"display"))}function f(e,t,n,o){var r,i,a,s,c=0==n;if(d.isAncestorOf(t,e))return e;if(d.isCharacterDataNode(t))if(0==n)n=d.getNodeIndex(t),t=t.parentNode;else{if(n!=t.length)throw u.createError("splitNodeAt should not be called with offset in the middle of a data node ("+n+" in "+t.data);n=d.getNodeIndex(t)+1,t=t.parentNode}if(a=t,s=n,d.isCharacterDataNode(a)?0==s?a.previousSibling:s!=a.length||a.nextSibling:0<s&&s<a.childNodes.length){if(!r){for((r=t.cloneNode(!1)).id&&r.removeAttribute("id");i=t.childNodes[n];)r.appendChild(i);d.insertAfter(r,t)}return t==e?r:f(e,r.parentNode,d.getNodeIndex(r),o)}return e!=t?(r=t.parentNode,s=d.getNodeIndex(t),c||s++,f(e,r,s,o)):e}function x(o){var r=o?"nextSibling":"previousSibling";return function(e,t){var n=e.parentNode,e=e[r];if(e){if(3==e.nodeType)return e}else if(t&&(e=n[r])&&1==e.nodeType&&(t=e,(n=n).tagName==t.tagName&&v(n,t)&&w(n,t)))return e[o?"firstChild":"lastChild"];return null}}function A(e){this.isElementMerge=1==e.nodeType,this.firstTextNode=this.isElementMerge?e.lastChild:e,this.textNodes=[this.firstTextNode]}function s(e,t,n){var o,r,i,a,s,c,d;if(this.cssClass=e,a=null,"object"==typeof t&&null!==t){for(n=t.tagNames,a=t.elementProperties,o=0;i=g[o++];)t.hasOwnProperty(i)&&(this[i]=t[i]);d=t.normalize}else d=t;for(c in this.normalize=void 0===d||d,this.attrExceptions=[],s=document.createElement(this.elementTagName),this.elementProperties={},a)a.hasOwnProperty(c)&&(s[c=l.hasOwnProperty(c)?l[c]:c]=a[c],this.elementProperties[c]=s[c],this.attrExceptions.push(c));if(this.elementSortedClassName=this.elementProperties.hasOwnProperty("className")?N(this.elementProperties.className+" "+e):e,this.applyToAnyTagName=!1,"string"==(d=typeof n))"*"==n?this.applyToAnyTagName=!0:this.tagNames=n.toLowerCase().replace(/^\s\s*/,"").replace(/\s\s*$/,"").split(/\s*,\s*/);else if("object"==d&&"number"==typeof n.length)for(this.tagNames=[],o=0,r=n.length;o<r;++o)"*"==n[o]?this.applyToAnyTagName=!0:this.tagNames.push(n[o].toLowerCase());else this.tagNames=[this.elementTagName]}a.requireModules(["WrappedSelection","WrappedRange"]),d=a.dom,r=function(e,t){e.className&&(e.className=e.className.replace(new RegExp("(?:^|\\s)"+t+"(?:\\s|$)"),p))},"undefined"!=typeof window.getComputedStyle?t=function(e,t){return d.getWindow(e).getComputedStyle(e,null)[t]}:"undefined"!=typeof document.documentElement.currentStyle?t=function(e,t){return e.currentStyle[t]}:u.fail("No means of obtaining computed style properties found"),e=document.createElement("div"),n="boolean"==typeof e.isContentEditable?function(e){return e&&1==e.nodeType&&e.isContentEditable}:function(e){return!(!e||1!=e.nodeType||"false"==e.contentEditable)&&("true"==e.contentEditable||n(e.parentNode))},c=/^inline(-block|-table)?$/i,m=x(!(h=/[^\r\n\t\f \u200B]/)),C=x(!0),A.prototype={doMerge:function(){for(var e,t,n,o=[],r=0,i=this.textNodes.length;r<i;++r)t=(e=this.textNodes[r]).parentNode,o[r]=e.data,r&&(t.removeChild(e),t.hasChildNodes()||t.parentNode.removeChild(t));return this.firstTextNode.data=n=o.join(""),n},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){for(var e=[],t=0,n=this.textNodes.length;t<n;++t)e[t]="'"+this.textNodes[t].data+"'";return"[Merge("+e.join(",")+")]"}},l={"class":"className"},s.prototype={elementTagName:"span",elementProperties:{},ignoreWhiteSpace:!0,applyToEditableOnly:!(g=["elementTagName","ignoreWhiteSpace","applyToEditableOnly"]),hasClass:function(e){return 1==e.nodeType&&d.arrayContains(this.tagNames,e.tagName.toLowerCase())&&o(e,this.cssClass)},getSelfOrAncestorWithClass:function(e){for(;e;){if(this.hasClass(e,this.cssClass))return e;e=e.parentNode}return null},isModifiable:function(e){return!this.applyToEditableOnly||_(e)},isIgnorableWhiteSpaceNode:function(e){return this.ignoreWhiteSpace&&e&&3==e.nodeType&&function(e){if(0==e.data.length)return!0;if(h.test(e.data))return!1;switch(t(e.parentNode,"whiteSpace")){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(e.data))return!1}return D(e.previousSibling)||D(e.nextSibling)}(e)},postApply:function(e,t,n){for(var o,r,i,l,f=e[0],a=e[e.length-1],s=[],u=f,h=a,g=0,p=a.length,c=0,d=e.length;c<d;++c)r=e[c],(i=m(r,!n))?(o||(o=new A(i),s.push(o)),o.textNodes.push(r),r===f&&(g=(u=o.firstTextNode).length),r===a&&(h=o.firstTextNode,p=o.getLength())):o=null;if((l=C(a,!n))&&(o||(o=new A(a),s.push(o)),o.textNodes.push(l)),s.length){for(c=0,d=s.length;c<d;++c)s[c].doMerge();t.setStart(u,g),t.setEnd(h,p)}},createContainer:function(e){e=e.createElement(this.elementTagName);return a.util.extend(e,this.elementProperties),i(e,this.cssClass),e},applyToTextNode:function(e){var t=e.parentNode;1==t.childNodes.length&&d.arrayContains(this.tagNames,t.tagName.toLowerCase())?i(t,this.cssClass):(t=this.createContainer(d.getDocument(e)),e.parentNode.insertBefore(t,e),t.appendChild(e))},isRemovable:function(e){return e.tagName.toLowerCase()==this.elementTagName&&R(e)==this.elementSortedClassName&&function(e,t){for(var n in t)if(t.hasOwnProperty(n)&&e[n]!==t[n])return!1;return!0}(e,this.elementProperties)&&!T(e,this.attrExceptions)&&this.isModifiable(e)},undoToTextNode:function(e,t,n){var o;t.containsNode(n)||((o=t.cloneRange()).selectNode(n),o.isPointInRange(t.endContainer,t.endOffset)&&(f(n,t.endContainer,t.endOffset,[t]),t.setEndAfter(n)),o.isPointInRange(t.startContainer,t.startOffset)&&(n=f(n,t.startContainer,t.startOffset,[t]))),this.isRemovable(n)?E(n):r(n,this.cssClass)},applyToRange:function(e){var t,n,o,r;if(e.splitBoundaries(),(t=y(e)).length){for(o=0,r=t.length;o<r;++o)n=t[o],
this.isIgnorableWhiteSpaceNode(n)||this.getSelfOrAncestorWithClass(n)||!this.isModifiable(n)||this.applyToTextNode(n);e.setStart(t[0],0),n=t[t.length-1],e.setEnd(n,n.length),this.normalize&&this.postApply(t,e,!1)}},applyToSelection:function(e){var t,n,o,r;for(e=e||window,o=(t=a.getSelection(e)).getAllRanges(),t.removeAllRanges(),r=o.length;r--;)n=o[r],this.applyToRange(n),t.addRange(n)},undoToRange:function(e){var t,n,o,r,i,a;if(e.splitBoundaries(),r=(t=y(e))[t.length-1],t.length){for(i=0,a=t.length;i<a;++i)n=t[i],(o=this.getSelfOrAncestorWithClass(n))&&this.isModifiable(n)&&this.undoToTextNode(n,e,o),e.setStart(t[0],0),e.setEnd(r,r.length);this.normalize&&this.postApply(t,e,!0)}},undoToSelection:function(e){var t,n,o,r,i;for(e=e||window,n=(t=a.getSelection(e)).getAllRanges(),t.removeAllRanges(),r=0,i=n.length;r<i;++r)o=n[r],this.undoToRange(o),t.addRange(o)},getTextSelectedByRange:function(e,t){var n=t.cloneRange();return n.selectNodeContents(e),t=(e=n.intersection(t))?e.toString():"",n.detach(),t},isAppliedToRange:function(e){var t,n,o;if(e.collapsed)return!!this.getSelfOrAncestorWithClass(e.commonAncestorContainer);for(t=e.getNodes([3]),n=0;o=t[n++];)if(!this.isIgnorableWhiteSpaceNode(o)&&S(e,o)&&this.isModifiable(o)&&!this.getSelfOrAncestorWithClass(o))return!1;return!0},isAppliedToSelection:function(e){var t,n;for(e=e||window,n=(t=a.getSelection(e).getAllRanges()).length;n--;)if(!this.isAppliedToRange(t[n]))return!1;return!0},toggleRange:function(e){this.isAppliedToRange(e)?this.undoToRange(e):this.applyToRange(e)},toggleSelection:function(e){this.isAppliedToSelection(e)?this.undoToSelection(e):this.applyToSelection(e)},detach:function(){}},s.util={hasClass:o,addClass:i,removeClass:r,hasSameClasses:v,replaceWithOwnChildren:E,elementsHaveSameNonClassAttributes:w,elementHasNonClassAttributes:T,splitNodeAt:f,isEditableElement:n,isEditingHost:O,isEditable:_},a.CssClassApplier=s,a.createCssClassApplier=function(e,t,n){return new s(e,t,n)}}),rangy.createModule("SaveRestore",function(f,u){var r,i;function h(e,t){return(t||document).getElementById(e)}function l(e,t){var n="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),o=r.getDocument(e.startContainer),e=e.cloneRange();return e.collapse(t),(t=o.createElement("span")).id=n,t.style.lineHeight="0",t.style.display="none",t.className="rangySelectionBoundary",t.appendChild(o.createTextNode(i)),e.insertNode(t),e.detach(),t}function g(e,t,n,o){n=h(n,e);n?(t[o?"setStartBefore":"setEndBefore"](n),n.parentNode.removeChild(n)):u.warn("Marker element has been removed. Cannot restore selection.")}function p(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function a(e,t){t=h(t,e);t&&t.parentNode.removeChild(t)}f.requireModules(["DomUtil","DomRange","WrappedRange"]),r=f.dom,i="\ufeff",f.saveSelection=function(e){var t,n,o,r,i,a,s,c,d=(e=e||window).document;if(f.isSelectionValid(e)){for(o=[],(n=(t=f.getSelection(e)).getAllRanges()).sort(p),s=0,c=n.length;s<c;++s)(a=n[s]).collapsed?(i=l(a,!1),o.push({markerId:i.id,collapsed:!0})):(i=l(a,!1),r=l(a,!0),o[s]={startMarkerId:r.id,endMarkerId:i.id,collapsed:!1,backwards:1==n.length&&t.isBackwards()});for(s=c-1;0<=s;--s)(a=n[s]).collapsed?a.collapseBefore(h(o[s].markerId,d)):(a.setEndBefore(h(o[s].endMarkerId,d)),a.setStartAfter(h(o[s].startMarkerId,d)));return t.setRanges(n),{win:e,doc:d,rangeInfos:o,restored:!1}}u.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus.")},f.restoreSelection=function(e,l){var t,n,o,r,i,a,s,c,d;if(!e.restored){for(t=e.rangeInfos,n=f.getSelection(e.win),o=[],i=(r=t.length)-1;0<=i;--i)a=t[i],s=f.createRange(e.doc),a.collapsed?(c=h(a.markerId,e.doc))?(c.style.display="inline",(d=c.previousSibling)&&3==d.nodeType?(c.parentNode.removeChild(c),s.collapseToPoint(d,d.length)):(s.collapseBefore(c),c.parentNode.removeChild(c))):u.warn("Marker element has been removed. Cannot restore selection."):(g(e.doc,s,a.startMarkerId,!0),g(e.doc,s,a.endMarkerId,!1)),1==r&&s.normalizeBoundaries(),o[i]=s;1==r&&l&&f.features.selectionHasExtend&&t[0].backwards?(n.removeAllRanges(),n.addRange(o[0],!0)):n.setRanges(o),e.restored=!0}},f.removeMarkerElement=a,f.removeMarkers=function(e){for(var t,n=e.rangeInfos,o=0,r=n.length;o<r;++o)(t=n[o]).collapsed?a(e.doc,t.markerId):(a(e.doc,t.startMarkerId),a(e.doc,t.endMarkerId))}}),rangy.createModule("Serializer",function(s,c){var e,t,d,a,n;function f(){return n=n||function(){for(var e,t,n=[],o=0;o<256;++o){for(t=o,e=8;e--;)1==(1&t)?t=t>>>1^3988292384:t>>>=1;n[o]=t>>>0}return n}()}function u(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function i(e){e=function d(e,t){var n,o,r,i,a,s,c;switch(t=t||[],n=e.nodeType,r=(o=e.childNodes).length,i=[n,e.nodeName,r].join(":"),s=a="",n){case 3:a=u(e.nodeValue);break;case 8:a="\x3c!--"+u(e.nodeValue)+"--\x3e";break;default:a="<"+i+">",s="</>"}for(a&&t.push(a),c=0;c<r;++c)d(o[c],t);return s&&t.push(s),t}(e).join("");return t(e).toString(16)}function o(e,t,n){var o=[],r=e;for(n=n||d.getDocument(e).documentElement;r&&r!=n;)o.push(d.getNodeIndex(r,!0)),r=r.parentNode;return o.join("/")+":"+t}function l(e,t,n){var o,r,i,a;for(t?n=n||d.getDocument(t):t=(n=n||document).documentElement,o=t,i=(r=(n=e.split(":"))[0]?n[0].split("/"):[]).length;i--;){if(!((a=parseInt(r[i],10))<o.childNodes.length))throw c.createError("deserializePosition failed: node "+d.inspectNode(o)+" has no child with index "+a+", "+i);o=o.childNodes[parseInt(r[i],10)]}return new d.DomPosition(o,parseInt(n[1],10))}function h(e,t,n){if(n=n||s.DomRange.getRangeDocument(e).documentElement,!d.isAncestorOf(n,e.commonAncestorContainer,!0))throw new Error("serializeRange: range is not wholly contained within specified root node");e=o(e.startContainer,e.startOffset,n)+","+o(e.endContainer,e.endOffset,n);return t||(e+="{"+i(n)+"}"),e}function g(e,t,n){var o,r;if(t?n=n||d.getDocument(t):t=(n=n||document).documentElement,o=(e=/^([^,]+),([^,\{]+)({([^}]+)})?$/.exec(e))[4],r=i(t),
o&&o!==i(t))throw new Error("deserializeRange: checksums of serialized range root node ("+o+") and target root node ("+r+") do not match");return o=l(e[1],t,n),r=l(e[2],t,n),(e=s.createRange(n)).setStart(o.node,o.offset),e.setEnd(r.node,r.offset),e}function p(e,t,n){return t?n=n||d.getDocument(t):t=(n=n||document).documentElement,!(n=/^([^,]+),([^,]+)({([^}]+)})?$/.exec(e)[3])||n===i(t)}function m(e,t,n){for(var o,r=[],i=0,a=(o=(e=e||s.getSelection()).getAllRanges()).length;i<a;++i)r[i]=h(o[i],t,n);return r.join("|")}function r(e,t,n){var o,r,i,a;for(t?n=n||d.getWindow(t):t=(n=n||window).document.documentElement,o=e.split("|"),e=s.getSelection(n),r=[],i=0,a=o.length;i<a;++i)r[i]=g(o[i],t,n.document);return e.setRanges(r),e}s.requireModules(["WrappedSelection","WrappedRange"]),e="undefined",typeof encodeURIComponent!=e&&typeof decodeURIComponent!=e||c.fail("Global object is missing encodeURIComponent and/or decodeURIComponent method"),n=null,t=function(e){for(var t=function(e){for(var t,n=[],o=0,r=e.length;o<r;++o)(t=e.charCodeAt(o))<128?n.push(t):t<2048?n.push(t>>6|192,63&t|128):n.push(t>>12|224,t>>6&63|128,63&t|128);return n}(e),n=-1,o=f(),r=0,i=t.length;r<i;++r)n=n>>>8^o[255&(n^t[r])];return(-1^n)>>>0},d=s.dom,a="rangySerializedSelection",s.serializePosition=o,s.deserializePosition=l,s.serializeRange=h,s.deserializeRange=g,s.canDeserializeRange=p,s.serializeSelection=m,s.deserializeSelection=r,s.canDeserializeSelection=function(e,t,n){var o,r,i,a;for(t?o=n?n.document:d.getDocument(t):t=(n=n||window).document.documentElement,i=0,a=(r=e.split("|")).length;i<a;++i)if(!p(r[i],t,o))return!1;return!0},s.restoreSelectionFromCookie=function(e){var t=function(e){for(var t,n,o=e.split(/[;,]/),r=0,i=o.length;r<i;++r)if((t=o[r].split("="))[0].replace(/^\s+/,"")==a&&(n=t[1]))return decodeURIComponent(n.replace(/\s+$/,""));return null}((e=e||window).document.cookie);t&&r(t,e.doc)},s.saveSelectionCookie=function(e,t){var n,o,r,i;e=e||window,n=(t="object"==typeof t?t:{}).expires?";expires="+t.expires.toUTCString():"",o=t.path?";path="+t.path:"",r=t.domain?";domain="+t.domain:"",t=t.secure?";secure":"",i=m(s.getSelection(e)),e.document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(i)+n+o+r+t},s.getElementChecksum=i}),YUI.add("moodle-editor_ousupsub-rangy",function(e,t){rangy.initialized||rangy.init()},"@VERSION@",{requires:[]});